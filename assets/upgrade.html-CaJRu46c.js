import{_ as n,c as a,f as e,o as p}from"./app-LHpjaFTr.js";const l={};function t(i,s){return p(),a("div",null,s[0]||(s[0]=[e(`<h1 id="升级webpack5" tabindex="-1"><a class="header-anchor" href="#升级webpack5"><span>升级webpack5</span></a></h1><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://webpack.docschina.org/migrate/5/#upgrade-webpack-and-its-dependencies" target="_blank" rel="noopener noreferrer">升级指南</a></li><li><a href="https://www.mybj123.com/11258.html" target="_blank" rel="noopener noreferrer">记录将项目中webpack4升级至webpack5一次成功尝试</a></li></ul><h2 id="常见调整" tabindex="-1"><a class="header-anchor" href="#常见调整"><span>常见调整</span></a></h2><ul><li>npm-check-updates 升级相关依赖 <ul><li>注意类似 @babel/core 7 之前包名不同 <ul><li>如： babel-eslint 更换为 @babel/eslint-parser</li></ul></li><li>还有类似vue-loader 最新版本是vue3的, vue2的是15.x；</li></ul></li><li>node运行时添加<code>--trace-deprecation</code> 追踪废弃告警的栈堆信息，移除废弃的功能 <ul><li><code>node --trace-deprecation node_modules/webpack/bin/webpack.js</code> 或通过 <code>NODE_OPTIONS=--trace-deprecation</code>添加</li></ul></li><li><code>devtool</code>配置的值调整，没有了<code>#</code><ul><li><code>#cheap-module-source-map</code> -&gt; <code>cheap-module-source-map</code></li></ul></li><li><code>mini-css-extract-plugin</code>(vue ssr 使用会报错ReferenceError: document is not defined)或<code>extract-text-webpack-plugin</code> 插件升级 <ul><li>如下示例，可配置mini-css-extract-plugin抽离成一个文件</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">styles</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;styles&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;css/mini-extract&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&quot;all&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">enforce</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>一些loader的配置写法调整，多个loader放use中</p></li><li><p>optimization的一些配置调整，splitChunks的一些调整</p></li><li><p>vue ssr</p><ul><li>clientCompiler.hooks.done 钩子变化</li><li>webpack-dev-middleware 的文件系统 devMiddleware.context.outputFileSystem</li></ul></li><li><p>less 的unit 里面计算时再加括号</p><ul><li><code>@weuiCellLineHeight: unit(((@weuiCellHeight - 2 * @weuiCellGapV) / @weuiCellFontSize));</code></li></ul></li><li><p><code>terser-webpack-plugin</code> 代替 <code>uglifyjs-webpack-plugin</code></p></li><li><p>如果是webpack 3 升到5 ，需安装 <code>webpack-cli</code> 参数还略有不同</p></li><li><p>url-loader 、 css-loader 配置 <code>esModule: false</code></p></li><li><p>raw-loader、url-loader、file-loader 可替换为 <a href="https://webpack.docschina.org/guides/asset-modules/" target="_blank" rel="noopener noreferrer">asset module</a></p><ul><li>row-loader -&gt; asset/source</li><li>url-loader -&gt; asset 或 asset/inline</li><li>file-loader -&gt; asset/resource</li></ul></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(png|jpg|gif|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">				<span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset&#39;</span><span class="token punctuation">,</span></span>
<span class="line">				<span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">1024</span><span class="token punctuation">,</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">				<span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;images/[name][ext]?[hash]&#39;</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token punctuation">{</span></span>
<span class="line">                <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.(ttf|eot|woff|woff2)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;asset/resource&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&#39;fonts/[name][ext]?[hash]&#39;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="高版本nodejs-低版本webpack问题" tabindex="-1"><a class="header-anchor" href="#高版本nodejs-低版本webpack问题"><span>高版本nodejs，低版本webpack问题</span></a></h1><ul><li>nodejs17开始升级了openssl，webpack低版本会报错，解决方式： <ol><li>升级webpack 及 相应loader（最终解决方式）</li><li>降级nodejs版本，如使用nodejs16版本最新的长期支持版本（临时方案）</li><li>nodejs启动添加<code>--openssl-legacy-provider</code> 选项，或添加环境变量<code>NODE_OPTIONS=--openssl-legacy-provider</code>（临时方案）</li></ol></li></ul>`,10)]))}const r=n(l,[["render",t],["__file","upgrade.html.vue"]]),c=JSON.parse('{"path":"/frontend/engineering/webpack/upgrade.html","title":"升级webpack5","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"参考","slug":"参考","link":"#参考","children":[]},{"level":2,"title":"常见调整","slug":"常见调整","link":"#常见调整","children":[]}],"git":{"updatedTime":1731657125000,"contributors":[{"name":"sindorei","email":"wupan1030@foxmail.com","commits":6,"url":"https://github.com/sindorei"}]},"filePathRelative":"frontend/engineering/webpack/upgrade.md"}');export{r as comp,c as data};
