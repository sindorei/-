# 基本操作
- 代码必须正确无bug
- 正确地使用数据库的失误

# 订单系统的核心功能和数据
- 创建订单
- 随着购物流程更新订单状态
- 查询订单，包括用订单数据生成各种报表

## 表
- 订单主表
  * 保存订单的基本信息
  
- 订单商品表
  * 保存订单中的商品信息
  
- 订单支付表
  * 保存订单的支付和退款信息
  
- 订单优惠表
  * 保存订单使用的所有优惠信息
  

# 如何避免重复下单
- 让订单服务具备幂等性
  * 可以利用数据库的主键唯一约束特性，在插入数据的时候带上主键，来解决创建订单服务的幂等性问题
  * 用户进入创建订单页面时，前端调用生成订单号服务
  * 提交订单时带上生成的订单号
  * 重复订单返回创建成功，避免返回失败前端提示失败而实际创单成功
  

# 如何解决ABA问题
- 数据库更新操作本身就具备天然的幂等性
- 但在并发环境下需要注意ABA问题
  * 新增`version`列
  * 更新判断`version`，并把`version+1`


# 思考
- 还有哪些实现幂等的方法
  * 通过一些精巧的设计让更新本身就是幂等的
  * 利用外部的、具备一致性的存储（如MySQL）来做冲突检测