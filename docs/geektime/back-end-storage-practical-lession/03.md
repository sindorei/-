# 主要功能
- 把商品加入购物车
- 购物车列表页
- 发起结算下单
- 所有界面都要显示的购物车小图标


# 设计购物车存储时需要把握什么原则
- 如果未登录，需要临时暂存购物车的商品
- 用户登录时，把暂存购物车的商品合并到用户购物车中，并且清除暂存购物车
- 用户登录后购物车中的商品，需要在浏览器、手机APP和微信等终端中保持同步


# 如何设计"暂存购物车"的存储
- 保存在客户端好，节约存储资源，也不需要唯一标识
- 可根据情况选择cookie或localStorage
- 数据格式示例：
```
{
    "cart": [
        "SKUID": 888,
        "tiemstamp": 1578721136,
        "count": 1,
        "selected": true
    ]
}
```

# 如何设计"用户购物车"的存储
- 存在MySQL中
  * 便于应对变化，系统的扩展性更好
  * 表结构
     * id 自增id
     * user_id 用户ID
     * sku_id 商品ID
     * count 商品数量
     * timestamp 加购时间
     * selected 选购状态
- 也可以选择Redis存储
  * 牺牲一点数据可靠性，换来更高的性能
  * HASH
  

# 思考题
- 数据存在MySQL,用redis做缓存，是否可行？可行的话如何保证redis中的数据和MySQL中的一致


# 上节思考题
- 商品系统中需要保存包含价格的商品基本信息的历史记录，对每次变更记录一个自增的版本号
- 下单的请求中不仅要带上SKUID，还要带上版本号
- 订单服务以请求中的商品版本对应的价格来创建订单
- 需要增加检测逻辑，防止被恶意利用此机制
  * 请求中的版本只能是当前版本或上一个版本
  * 并使用上一个版本有时间限制
     * 如调价5s后不再接受上个版本的请求