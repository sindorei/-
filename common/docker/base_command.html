<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>命令文档 | 笔记</title><meta name="description" content="学习及练习的记录">
    <link rel="preload" href="/note/assets/style-BYxJ5vVe.css" as="style"><link rel="stylesheet" href="/note/assets/style-BYxJ5vVe.css">
    <link rel="modulepreload" href="/note/assets/app-LHpjaFTr.js"><link rel="modulepreload" href="/note/assets/base_command.html-CHIvgGjv.js">
    <link rel="prefetch" href="/note/assets/index.html-CRKJAktu.js" as="script"><link rel="prefetch" href="/note/assets/编程语言的设计与实现.html-DMqrpBQ5.js" as="script"><link rel="prefetch" href="/note/assets/game.html-BpAPjRzA.js" as="script"><link rel="prefetch" href="/note/assets/go.html-DVSc15Kw.js" as="script"><link rel="prefetch" href="/note/assets/index.html-BoNoRfZV.js" as="script"><link rel="prefetch" href="/note/assets/object.html-CpQ6YJU-.js" as="script"><link rel="prefetch" href="/note/assets/index.html-BzmysG6T.js" as="script"><link rel="prefetch" href="/note/assets/index.html-CdhVk01G.js" as="script"><link rel="prefetch" href="/note/assets/docker_file.html-B5BYohMD.js" as="script"><link rel="prefetch" href="/note/assets/index.html-CTdpb_rx.js" as="script"><link rel="prefetch" href="/note/assets/nodejs_image.html-DZicQK8S.js" as="script"><link rel="prefetch" href="/note/assets/git.html-CwBwNumC.js" as="script"><link rel="prefetch" href="/note/assets/http.html-CO9DwlcH.js" as="script"><link rel="prefetch" href="/note/assets/01.html-D08vSd6w.js" as="script"><link rel="prefetch" href="/note/assets/index.html-CNuxsu-u.js" as="script"><link rel="prefetch" href="/note/assets/flex.html-DeYvkDAP.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DAiJKrDV.js" as="script"><link rel="prefetch" href="/note/assets/index.html-CC79gBXK.js" as="script"><link rel="prefetch" href="/note/assets/ssr.html-CzWTTslj.js" as="script"><link rel="prefetch" href="/note/assets/vue3.html-BkjS9Z6u.js" as="script"><link rel="prefetch" href="/note/assets/01.html-BGyc60LY.js" as="script"><link rel="prefetch" href="/note/assets/02.html-D403JbXn.js" as="script"><link rel="prefetch" href="/note/assets/03.html-CGD6-qXW.js" as="script"><link rel="prefetch" href="/note/assets/04.html-PTAWabi_.js" as="script"><link rel="prefetch" href="/note/assets/05.html-CWFDSO4R.js" as="script"><link rel="prefetch" href="/note/assets/06.html-Ge6hEPSP.js" as="script"><link rel="prefetch" href="/note/assets/07.html-DG337sUc.js" as="script"><link rel="prefetch" href="/note/assets/08.html-CXQlh6qu.js" as="script"><link rel="prefetch" href="/note/assets/09.html-DobF94Gq.js" as="script"><link rel="prefetch" href="/note/assets/10.html-V02h8t29.js" as="script"><link rel="prefetch" href="/note/assets/11.html-Cxoqw4eS.js" as="script"><link rel="prefetch" href="/note/assets/12.html-YwJ00UTC.js" as="script"><link rel="prefetch" href="/note/assets/13.html-C4l31hYp.js" as="script"><link rel="prefetch" href="/note/assets/14.html-DBw4HV5O.js" as="script"><link rel="prefetch" href="/note/assets/15.html-DFEadcEY.js" as="script"><link rel="prefetch" href="/note/assets/16.html-BiiDI-MZ.js" as="script"><link rel="prefetch" href="/note/assets/17.html-CjzgDSV0.js" as="script"><link rel="prefetch" href="/note/assets/23.html-p-unLygU.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DGGZ1YGN.js" as="script"><link rel="prefetch" href="/note/assets/index.html-l-1l6LtJ.js" as="script"><link rel="prefetch" href="/note/assets/ap.html-CnmIQwyq.js" as="script"><link rel="prefetch" href="/note/assets/basic_sentence.html-CHMQ4J1P.js" as="script"><link rel="prefetch" href="/note/assets/clause.html-DDuuROBl.js" as="script"><link rel="prefetch" href="/note/assets/difference.html-CsOpK_XV.js" as="script"><link rel="prefetch" href="/note/assets/english_grammar_system.html-C8Go9I1E.js" as="script"><link rel="prefetch" href="/note/assets/noun.html-C9hRA14e.js" as="script"><link rel="prefetch" href="/note/assets/noun_phrase.html-DWz5xJO7.js" as="script"><link rel="prefetch" href="/note/assets/other.html-Bxlzxm-F.js" as="script"><link rel="prefetch" href="/note/assets/part_of_speech.html-BdGvDch7.js" as="script"><link rel="prefetch" href="/note/assets/phonetic_symbol.html-COKk3LiF.js" as="script"><link rel="prefetch" href="/note/assets/pronunciation_respelling.html-CASSzY-d.js" as="script"><link rel="prefetch" href="/note/assets/spoken_english.html-9A11oUFP.js" as="script"><link rel="prefetch" href="/note/assets/tense.html-Bp6DLOFz.js" as="script"><link rel="prefetch" href="/note/assets/vedios.html-CZFUZ8uU.js" as="script"><link rel="prefetch" href="/note/assets/word.html-sCscP_by.js" as="script"><link rel="prefetch" href="/note/assets/yinxingyi.html-Dz9DHIDO.js" as="script"><link rel="prefetch" href="/note/assets/zhangdaozhen.html-qGrFL9y7.js" as="script"><link rel="prefetch" href="/note/assets/bootstrap.html-B7goD2y1.js" as="script"><link rel="prefetch" href="/note/assets/dns.html-BtlwnnRk.js" as="script"><link rel="prefetch" href="/note/assets/file.html-DdTHP9HO.js" as="script"><link rel="prefetch" href="/note/assets/file_watch.html-CAVAmcLY.js" as="script"><link rel="prefetch" href="/note/assets/http.html-BrsbBXzu.js" as="script"><link rel="prefetch" href="/note/assets/index.html-ma5b5YJ4.js" as="script"><link rel="prefetch" href="/note/assets/memory.html-BBJmuRQo.js" as="script"><link rel="prefetch" href="/note/assets/module.html-DDdLXPNq.js" as="script"><link rel="prefetch" href="/note/assets/process.html-WBKE4Y4I.js" as="script"><link rel="prefetch" href="/note/assets/runtime.html-BLnJGDB_.js" as="script"><link rel="prefetch" href="/note/assets/setImmediate.html-DCBPJllt.js" as="script"><link rel="prefetch" href="/note/assets/tcp.html-Tzei2pG2.js" as="script"><link rel="prefetch" href="/note/assets/tcp_server_client.html-PlTwphfT.js" as="script"><link rel="prefetch" href="/note/assets/thread.html-pxQtUnzX.js" as="script"><link rel="prefetch" href="/note/assets/udp.html-CG1Hylul.js" as="script"><link rel="prefetch" href="/note/assets/unix_fd.html-CGjgL0dh.js" as="script"><link rel="prefetch" href="/note/assets/curl.html-CiO5vNwi.js" as="script"><link rel="prefetch" href="/note/assets/index.html-D8kuWLtK.js" as="script"><link rel="prefetch" href="/note/assets/singleton.html-BZZtufAV.js" as="script"><link rel="prefetch" href="/note/assets/command.html-Dub5Hj_m.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DSKs7BF_.js" as="script"><link rel="prefetch" href="/note/assets/index.html-C-sKCQde.js" as="script"><link rel="prefetch" href="/note/assets/11-20.html-DpEQDb6H.js" as="script"><link rel="prefetch" href="/note/assets/index.html-CW1ro9zz.js" as="script"><link rel="prefetch" href="/note/assets/control.html-DbrYfu72.js" as="script"><link rel="prefetch" href="/note/assets/coroutine.html-CXgFu5Kg.js" as="script"><link rel="prefetch" href="/note/assets/error_except.html-XpaplLQ7.js" as="script"><link rel="prefetch" href="/note/assets/function.html-BYaXKKOL.js" as="script"><link rel="prefetch" href="/note/assets/index.html-BQYErj4Q.js" as="script"><link rel="prefetch" href="/note/assets/module.html-DuJWV5-u.js" as="script"><link rel="prefetch" href="/note/assets/operator.html-Bl8Ll6sn.js" as="script"><link rel="prefetch" href="/note/assets/types.html-Eo9QZ4HV.js" as="script"><link rel="prefetch" href="/note/assets/class.html-91Gr4n-o.js" as="script"><link rel="prefetch" href="/note/assets/control_flow.html-BDFi5U9A.js" as="script"><link rel="prefetch" href="/note/assets/error_except.html-BJHPkAqX.js" as="script"><link rel="prefetch" href="/note/assets/function.html-sbFdXM7Z.js" as="script"><link rel="prefetch" href="/note/assets/index.html-C9i3pZ5V.js" as="script"><link rel="prefetch" href="/note/assets/module.html-CeUICiZp.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DSw-RJA-.js" as="script"><link rel="prefetch" href="/note/assets/start.html-DdNFeOvS.js" as="script"><link rel="prefetch" href="/note/assets/trpl.html-BtmJ3sJj.js" as="script"><link rel="prefetch" href="/note/assets/closure.html-CoNM3Qld.js" as="script"><link rel="prefetch" href="/note/assets/control_flow.html-5oKkjaOS.js" as="script"><link rel="prefetch" href="/note/assets/function.html-BAz4Sybn.js" as="script"><link rel="prefetch" href="/note/assets/index.html-D9utc7LP.js" as="script"><link rel="prefetch" href="/note/assets/operator.html-BIfws0KF.js" as="script"><link rel="prefetch" href="/note/assets/types.html-DZ1oI1e1.js" as="script"><link rel="prefetch" href="/note/assets/index.html-Bmceai8b.js" as="script"><link rel="prefetch" href="/note/assets/introduction.html-BEwqBwa_.js" as="script"><link rel="prefetch" href="/note/assets/bem.html-BscxAu2c.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DuSoPzyE.js" as="script"><link rel="prefetch" href="/note/assets/index.html-Dh6Ek41Y.js" as="script"><link rel="prefetch" href="/note/assets/code_spliting.html-Dj5pKKWS.js" as="script"><link rel="prefetch" href="/note/assets/index.html-DcdBaI7M.js" as="script"><link rel="prefetch" href="/note/assets/tapable.html-DvpxAFCy.js" as="script"><link rel="prefetch" href="/note/assets/upgrade.html-CaJRu46c.js" as="script"><link rel="prefetch" href="/note/assets/index.html-B9menBKR.js" as="script"><link rel="prefetch" href="/note/assets/1.html-BTh8slHL.js" as="script"><link rel="prefetch" href="/note/assets/2.html-ItJLJwEM.js" as="script"><link rel="prefetch" href="/note/assets/3.html-7uCZe3p0.js" as="script"><link rel="prefetch" href="/note/assets/4.html-bq3pIVs0.js" as="script"><link rel="prefetch" href="/note/assets/index.html-ZMjTc9x_.js" as="script"><link rel="prefetch" href="/note/assets/data_struct.html-BuYtyN7t.js" as="script"><link rel="prefetch" href="/note/assets/eventloop.html-_2UGpvb8.js" as="script"><link rel="prefetch" href="/note/assets/libuv_js.html-CAO1XwO_.js" as="script"><link rel="prefetch" href="/note/assets/stream.html-CRD2yEUX.js" as="script"><link rel="prefetch" href="/note/assets/thread.html-CtgZ_SME.js" as="script"><link rel="prefetch" href="/note/assets/index.html-kRfWoiyf.js" as="script"><link rel="prefetch" href="/note/assets/qml_syntax.html-J-OJ77lS.js" as="script"><link rel="prefetch" href="/note/assets/404.html-DNCO1rp7.js" as="script"><link rel="prefetch" href="/note/assets/setupDevtools-7MC2TMWH-C61GSS5L.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container no-sidebar external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/note/"><!----><span class="vp-site-name" aria-hidden="true">笔记</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><!----><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><!----><!--[--><!--]--><!----><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="命令文档" tabindex="-1"><a class="header-anchor" href="#命令文档"><span>命令文档</span></a></h1><ul><li>https://docs.docker.com/engine/reference/commandline/docker/</li></ul><h1 id="镜像" tabindex="-1"><a class="header-anchor" href="#镜像"><span>镜像</span></a></h1><ul><li>类似虚拟机模板</li><li>等价于未运行的容器</li><li>相关命令 <ul><li>查看镜像列表 <code>docker image ls</code></li><li>获取（拉取 pulling）镜像：<code>docker image pull</code></li><li>查看镜像详细信息<code>docker images -a</code> -q 查看镜像id</li><li>搜索镜像 <code>docker search</code></li><li>删除镜像 <code>docker rmi</code> , <code>docker image rm</code></li></ul></li></ul><h2 id="镜像原理" tabindex="-1"><a class="header-anchor" href="#镜像原理"><span>镜像原理</span></a></h2><ul><li>docker镜像是由特殊的文件系统叠加而成</li><li>最底层是bootfs，并使用宿主机的bootfs</li><li>第二层是root文件系统rootfs，称为base image</li><li>再往上可以叠加其他的镜像文件</li><li>统一文件系统（Union File System）技术能够将不同的层整合成一个文件系统，为这些层提供一个统一的视角。这样隐藏了多层的存在，在用户的角度，只存在一个文件系统</li><li>一个镜像可以放在另一个镜像的上面，位于下面的镜像称为父镜像，最底部的镜像称为基础镜像</li><li>当从一个镜像启动容器时，docker会在最顶层加载一个读写文件系统作为容器</li></ul><h2 id="镜像制作" tabindex="-1"><a class="header-anchor" href="#镜像制作"><span>镜像制作</span></a></h2><ul><li>将运行中的容器转为镜像 <ul><li><code>docker commit [容器id] [镜像名称]:[版本号]</code></li><li>镜像转成压缩文件：<code>docker save -o 压缩文件名称 镜像名称:版本号</code></li><li>将压缩文件加载为镜像：<code>docker load -i 压缩文件名称</code></li></ul></li><li>Dockerfile</li></ul><h1 id="容器" tabindex="-1"><a class="header-anchor" href="#容器"><span>容器</span></a></h1><ul><li><p><code>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p></li><li><p><code>docker container run [OPTIONS] IMAGE [COMMAND] [ARG...]</code></p></li><li><p><code>docker container run -it ubuntu:latest /bin/bash</code></p><ul><li><code>-it</code>参数会将shell切换到容器终端</li><li>后面还可以跟容器中运行哪个进程</li></ul></li><li><p>按ctrl+p+q组合键可以在退出容器的同时保持容器运行，这样shell就会返回docker主机终端</p></li><li><p><code>docker container ls</code> 、<code>docker ps</code></p><ul><li>查看系统内部全部处于运行状态的容器</li><li><code>-a</code> 参数可以查看已删除的容器</li></ul></li><li><p><code>docker container exec [OPTIONS] CONTAINER COMMAND [ARG...]</code> 在运行中的容器中执行command</p></li><li><p>停止容器 <code>docker container stop</code></p></li><li><p>删除容器 <code>docker container rm</code></p></li><li><p>开始已经停止的容器 <code>docker start</code></p></li><li><p>查看容器信息：<code>docker inspect [OPTIONS] NAME|ID [NAME|ID...]</code></p></li><li><p>端口映射： <code>-p [宿主机端口号]:[容器端口号]</code></p></li><li><p>设置环境变量：[--env | -e] 变量名=变量值</p></li></ul><h1 id="数据卷-volume" tabindex="-1"><a class="header-anchor" href="#数据卷-volume"><span>数据卷 volume</span></a></h1><ul><li><p>宿主机的一个目录或文件</p></li><li><p>设置</p><ul><li>启动容器时使用 <code>--volume | -v</code> 设置</li><li><code>docker run - v [[宿主机目录|文件]:][容器目录|文件]</code><ul><li>不知道宿主机目录则会自动分配</li></ul></li><li>目录必须绝对路径</li><li>目录不存在会自动创建</li><li>可挂载多个数据卷</li></ul></li><li><p>数据卷容器</p><ul><li><code>docker run --volumes-from [容器名]</code></li></ul></li><li><p>作用</p><ul><li>容器数据持久化</li><li>客户端和容器数据交换</li><li>容器间数据交换</li></ul></li></ul><h1 id="应用部署" tabindex="-1"><a class="header-anchor" href="#应用部署"><span>应用部署</span></a></h1><ul><li>搜索镜像 <ul><li><code>docker search</code></li></ul></li><li>拉取镜像 <ul><li><code>docker pull</code></li></ul></li><li>创建容器,设置端口映射、目录映射 <ul><li><code>docker run -id --name -p -v</code></li></ul></li><li>测试访问</li></ul><h1 id="构建" tabindex="-1"><a class="header-anchor" href="#构建"><span>构建</span></a></h1><ul><li><code>docker build [OPTIONS] PATH | URL | -</code></li><li><code>docker build -f [Dockerfile 文件名] -t [构建后的镜像名称 name:tag] .</code></li></ul><h1 id="应用容器化" tabindex="-1"><a class="header-anchor" href="#应用容器化"><span>应用容器化</span></a></h1><ul><li>将应用代码构建到Docker镜像中，然后以容器的方式启动该镜像</li></ul><h1 id="docker镜像优化" tabindex="-1"><a class="header-anchor" href="#docker镜像优化"><span>Docker镜像优化</span></a></h1><ul><li>镜像大小优化 <ul><li>减少镜像层数 <ul><li>合并指令 <ul><li>COPY、ADD 和 RUN 语句会向镜像中添加新层</li><li>COPY和ADD会检查复制到镜像中的内容自上一次构建以后是否发生变化（会计算每个被复制文件的chunksum值与缓存镜像层中同一个文件的chunksum进行对比）</li></ul></li><li>使用多阶段构建压缩层、只包含必要的构建结果</li></ul></li><li>优化镜像依赖 <ul><li>使用distroless 只包含应用程序及其运行时依赖项</li><li>使用小体积的 Alpine 基础镜像</li><li>如果RUN 指令中有安装软件的操作，要在RUN 指令的最后清除掉软件仓库的缓存</li></ul></li></ul></li><li>利用镜像缓存 <ul><li>调整Dockerfile中的指令顺序充分利用缓存 <ul><li>把变化最少的部分放在 Dockerfile 的前面，这样可以充分利用镜像缓存。（一旦未命中缓存，后续的构建都不再使用缓存）</li></ul></li></ul></li></ul><h2 id="以node-js或前端项目docker构建举例" tabindex="-1"><a class="header-anchor" href="#以node-js或前端项目docker构建举例"><span>以node.js或前端项目docker构建举例</span></a></h2><ul><li>利用镜像缓存来减少依赖安装时间</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">COPY package.json package-lock.json ./</span>
<span class="line">RUN npm install</span>
<span class="line"></span>
<span class="line"># 复制剩余文件</span>
<span class="line">COPY . .</span>
<span class="line">RUN npm run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>构建完成后，清理依赖，只安装生产环境依赖 <ul><li><code>yarn install --production</code></li></ul></li></ul><h1 id="登录" tabindex="-1"><a class="header-anchor" href="#登录"><span>登录</span></a></h1><ul><li><code>docker login [OPTIONS] [仓库地址]</code><ul><li>OPTIONS <ul><li>--password、-p</li><li>--password-stdin</li><li>--username、-u</li></ul></li></ul></li></ul><h1 id="通过-docker-tag-命令重命名镜像" tabindex="-1"><a class="header-anchor" href="#通过-docker-tag-命令重命名镜像"><span>通过 docker tag 命令重命名镜像</span></a></h1><p>docker tag [imageID] hub.docker.com/[project]/[repository]:[tag]</p><h1 id="通过-docker-push-命令上传镜像" tabindex="-1"><a class="header-anchor" href="#通过-docker-push-命令上传镜像"><span>通过 docker push 命令上传镜像</span></a></h1><p>docker push hub.docker.com/[project]/[repository]:[tag]</p><h1 id="docker-服务编排" tabindex="-1"><a class="header-anchor" href="#docker-服务编排"><span>docker 服务编排</span></a></h1><ul><li>根据一定的业务规则批量地管理容器</li></ul><h2 id="docker-compose" tabindex="-1"><a class="header-anchor" href="#docker-compose"><span>Docker Compose</span></a></h2><ul><li>利用Dockerfile定义运行环境镜像</li><li>利用docker-compose.yml定义组成应用的各服务</li><li>运行docker-compose up 启动应用</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wupan1030@foxmail.com">sindorei</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/note/assets/app-LHpjaFTr.js" defer></script>
  </body>
</html>
